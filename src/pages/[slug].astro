---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import CalendarBooking from '../components/CalendarBooking.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

type Props = {
  article: CollectionEntry<'articles'>;
};

const { article } = Astro.props as Props;
const { Content } = await article.render();
---

<BaseLayout title={article.data.title} description={article.data.description}>
    <Navigation />

    <!-- Offer Banner -->
    <div class="text-white text-center py-3 mt-16 bg-gradient-to-r from-primary to-secondary shadow-md">
        <p class="text-sm md:text-base font-semibold">ðŸŽ‰ OFERTÄ‚ SPECIALÄ‚: -20% la micropigmentare sprÃ¢ncene pÃ¢nÄƒ la 31 decembrie! ðŸŽ‰</p>
    </div>

    <main class="pt-8 pb-20 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4">
            <!-- Article Header -->
            <article class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <header class="mb-12 px-8 pt-12 pb-8 bg-gradient-to-b from-gray-50 to-white">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight">{article.data.title}</h1>
                    <p class="text-xl text-gray-600 leading-relaxed">{article.data.description}</p>
                </header>

                <!-- Article Content -->
                <div class="px-8 pb-12">
                    <div class="prose prose-lg max-w-none prose-headings:text-gray-900 prose-h2:text-2xl prose-h2:font-bold prose-h2:mt-8 prose-h2:mb-4 prose-h3:text-xl prose-h3:font-semibold prose-h3:mt-6 prose-h3:mb-3 prose-p:text-gray-700 prose-p:leading-relaxed prose-strong:text-primary prose-strong:font-bold prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-ul:my-4 prose-li:text-gray-700 prose-img:rounded-lg prose-img:shadow-md prose-img:my-4 prose-img:mx-1 prose-img:h-[150px] prose-img:w-auto prose-img:inline-block prose-img:border-2 prose-img:border-gray-100 prose-img:cursor-pointer prose-img:hover:shadow-xl prose-img:transition-shadow prose-img:object-cover md:prose-img:h-[200px] md:prose-img:mx-2">
                        <Content />
                    </div>

                    <!-- Tags Section -->
                    <div class="mt-12 pt-8 border-t border-gray-200">
                        <div class="flex flex-wrap gap-2">
                            <span class="text-sm text-gray-500 font-medium mr-2">Etichete:</span>
                            {article.data.tags.map((tag: string) => (
                                <span class="text-xs bg-primary/10 text-primary px-3 py-1.5 rounded-full font-medium">
                                    {tag}
                                </span>
                            ))}
                        </div>
                    </div>
                </div>

                <!-- CTA Section -->
                <div class="mx-8 mb-8 p-8 bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl border border-primary/20">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 text-center">Gata sÄƒ Ã®ncepi?</h3>
                    <p class="text-gray-600 text-center mb-6 text-lg">
                        ProgrameazÄƒ o consultaÈ›ie gratuitÄƒ È™i descoperÄƒ cum te pot ajuta!
                    </p>
                    <div class="flex justify-center">
                        <button class="open-calendar-booking text-white bg-primary hover:bg-primary-hover focus:ring-4 focus:ring-secondary font-medium rounded-lg text-lg px-8 py-3 shadow-md hover:shadow-lg transition-all">
                            <i class="fas fa-calendar-check mr-2"></i>
                            ProgrameazÄƒ-te Acum
                        </button>
                    </div>
                </div>

                <!-- Back to Articles -->
                <div class="pb-8 text-center">
                    <a href="/articole/" class="inline-flex items-center text-primary hover:text-primary-hover font-medium text-lg">
                        <i class="fas fa-arrow-left mr-2"></i>
                        ÃŽnapoi la articole
                    </a>
                </div>
            </article>
        </div>
    </main>

    <CalendarBooking />
    <Footer />
</BaseLayout>

<style>
    /* Lightbox styles */
    .article-lightbox {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
        animation: fadeIn 0.3s;
    }

    .article-lightbox.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .article-lightbox-content {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        animation: zoomIn 0.3s;
    }

    .article-lightbox-close {
        position: absolute;
        top: 20px;
        right: 40px;
        color: white;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        z-index: 10000;
    }

    .article-lightbox-close:hover {
        color: #ccc;
    }

    .article-lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        font-size: 50px;
        font-weight: bold;
        cursor: pointer;
        padding: 20px;
        user-select: none;
        transition: 0.3s;
        z-index: 10000;
    }

    .article-lightbox-nav:hover {
        color: #ccc;
    }

    .article-lightbox-prev {
        left: 20px;
    }

    .article-lightbox-next {
        right: 20px;
    }

    .article-lightbox-counter {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-size: 18px;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 20px;
        border-radius: 20px;
        z-index: 10000;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes zoomIn {
        from { transform: scale(0.8); }
        to { transform: scale(1); }
    }
</style>

<script>
    // Initialize calendar modal for CTA button
    document.addEventListener('DOMContentLoaded', function() {
        const openButtons = document.querySelectorAll('.open-calendar-booking');
        const modal = document.getElementById('calendar-booking-modal');
        if (modal) {
            openButtons.forEach(button => {
                button.addEventListener('click', function() {
                    modal.classList.remove('hidden');
                });
            });
        }

        // Article image gallery/lightbox functionality
        const articleImages = document.querySelectorAll('.prose img');

        if (articleImages.length > 0) {
            // Create lightbox element
            const lightbox = document.createElement('div');
            lightbox.className = 'article-lightbox';
            lightbox.innerHTML = `
                <span class="article-lightbox-close">&times;</span>
                <span class="article-lightbox-nav article-lightbox-prev">&#10094;</span>
                <img class="article-lightbox-content" src="" alt="">
                <span class="article-lightbox-nav article-lightbox-next">&#10095;</span>
                <div class="article-lightbox-counter"></div>
            `;
            document.body.appendChild(lightbox);

            const lightboxImg = lightbox.querySelector('.article-lightbox-content');
            const closeBtn = lightbox.querySelector('.article-lightbox-close');
            const prevBtn = lightbox.querySelector('.article-lightbox-prev');
            const nextBtn = lightbox.querySelector('.article-lightbox-next');
            const counter = lightbox.querySelector('.article-lightbox-counter');

            let currentImageIndex = 0;
            const images = Array.from(articleImages);

            // Open lightbox
            images.forEach((img, index) => {
                img.addEventListener('click', function() {
                    currentImageIndex = index;
                    showImage(currentImageIndex);
                    lightbox.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            });

            // Show image function
            function showImage(index) {
                if (index < 0) index = images.length - 1;
                if (index >= images.length) index = 0;
                currentImageIndex = index;

                const img = images[index];
                lightboxImg.src = img.src;
                lightboxImg.alt = img.alt;
                counter.textContent = `${index + 1} / ${images.length}`;
            }

            // Close lightbox
            closeBtn.addEventListener('click', function() {
                lightbox.classList.remove('active');
                document.body.style.overflow = 'auto';
            });

            // Previous image
            prevBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                showImage(currentImageIndex - 1);
            });

            // Next image
            nextBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                showImage(currentImageIndex + 1);
            });

            // Close on background click
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    lightbox.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (lightbox.classList.contains('active')) {
                    if (e.key === 'Escape') {
                        lightbox.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    } else if (e.key === 'ArrowLeft') {
                        showImage(currentImageIndex - 1);
                    } else if (e.key === 'ArrowRight') {
                        showImage(currentImageIndex + 1);
                    }
                }
            });
        }
    });
</script>
